# Spring

## Spring事务的传播机制
  |传播机制|说明|
  |---|---|
  |PROPAGATION_REQUIRED|默认值，当前方法必须运行在事务内部。如果当前存在一个事务，则加入该事务；否则，新建一个事务。
  |PROPAGATION_SUPPORTS|当前方法不需要事务上下文，但是如果存在一个事务上下文，则该方法会加入这个事务上下文中。
  |PROPAGATION_MANDATORY|当前方法必须运行在事务上下文中，如果当前没有事务上下文，则会抛出一个异常。
  |PROPAGATION_REQUIRES_NEW|当前方法必须运行在它自己的事务中，如果当前存在一个事务，则挂起该事务。
  |PROPAGATION_NOT_SUPPORTED|当前方法不应该运行在事务上下文中，如果当前存在一个事务上下文，则将该事务挂起。
  |PROPAGATION_NEVER|当前方法不应该运行在事务上下文中，如果当前存在一个事务上下文，则会抛出一个异常。
  |PROPAGATION_NESTED|当前方法必须运行在一个嵌套的事务中，如果当前存在一个事务，则在该事务的上下文中嵌套一个新的事务。如果当前没有事务，则行为与PROPAGATION_REQUIRED相同。

## Spring事务失效的八种情况
   - 数据库引擎不支持事务
    - 没有被 Spring 管理
    - 方法不是 public 的
    - 自身调用问题
      - 因为它们发生了自身调用，就调该类自己的方法，而没有经过 Spring 的代理类，默认只有在外部调用事务才会生效，这也是老生常谈的经典问题了。这个的解决方案之一就是在的类中注入自己，用注入的对象再调用另外一个方法，这个不太优雅，另外一个可行的方案可以参考《Spring 如何在一个事务中开启另一个事务？》
    - 数据源没有配置事务管理器
    - 不支持事务
    - 异常被吃了
    - 异常类型错误


## 参考资料
   - [搞懂Spring事务失效的8大原因](https://www.toutiao.com/a6779079083574690312/)

--- 

- [回到首页](../../README.md)